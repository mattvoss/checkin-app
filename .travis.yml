language: node_js
os:
- osx
- linux
osx_image: xcode7
dist: trusty
sudo: required
node_js:
- '4'
- '6'
cache:
  apt: true
  bundler: true
  directories:
  - node_modules
  - test/testApp/node_modules
  - "$HOME/.electron"
  - "$HOME/.cache/fpm"
addons:
  apt:
    sources:
    - mono
    packages:
    - icnsutils
    - graphicsmagick
    - mono-devel
    - xz-utils
    - p7zip-full
before_install:
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ifconfig -a; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install git-lfs; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then git lfs pull; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then gem install fpm; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then curl -L https://github.com/github/git-lfs/releases/download/v1.2.0/git-lfs-linux-amd64-1.2.0.tar.gz | tar -xz; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then git-lfs-1.2.0/git-lfs pull; fi
install:
- nvm install 6
- npm install npm -g
- npm install
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then npm install -g 7zip-bin; fi
- npm install electron-builder@next
- npm prune
script:
- npm run dist
after_success:
- cd dist/
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then tar -czf osx.$DATE.tgz checkin-app-darwin-x64; fi
- ls -alt
- export SSHPASS=$DEPLOY_PASS
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then sshpass -e scp -o Cipher=aes256-ctr -v osx.$DATE.tgz $DEPLOY_HOST; fi
branches:
  except:
  - "/^v\\d+\\.\\d+\\.\\d+$/"
env:
  global:
  - secure: cVjJZ4mNUSYufMtrxVhgyMPltprssTz8v4amM3b9WETAWGIW4EzBlyv9W31G+etKhJt0TkEiROsARgnxcvu6L7JEHQduPcP3c3OyX+6AgIyWKVgphPnsJaXhILzHHMF8hXogIY51L049DohDH9RMIFilQefJM15ZNgnt0zDiZcs=
  - secure: EJxIKZ8KtSblxU0LWsyv04VJ5kfa21LBqSaGs6C9rf7muDVt21e/saUqudnVACbxSqW8jpNym4RNzjnhMYLNCTi/Vw2ymYKcBCt0wnw8U7pUercxyEywbzhgjdrQBJId2A1UMfVWjsFNUXmvU9zlsSlkbD9/cf4fKnfMjttgkWE=
  - DATE=$(date +%s)
